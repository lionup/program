------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_flows_j2j.log
  log type:  text
 opened on:  22 May 2012, 22:58:43

. 
. local x = 199401

. while `x' <= 201108 {
  2.  quietly{
  3.   if `x' != 199401 &`x' != 199506 & `x' != 199507 & `x' != 199508 & `x' != 199509 {
  4. 
.         use ../basic_extract/merg`x', replace
  5. 
.     * keep only the records at least 16 years old and with no missing value on labor status an
> d same job question in both months
.         keep if age >= 16
  6. 
.         gen str1 lfs0 = "E" if status0 == 1 | status0 == 2
  7.         replace lfs0 = "U" if status0 == 3 | status0 == 4 | status0 == 5 | status0 == 6 | s
> tatus0 == 7
  8.         drop if lfs0 == ""
  9.         gen str1 lfs1 = "E" if status1 == 1 | status1 == 2
 10.         replace lfs1 = "U" if status1 == 3 | status1 == 4 | status1 == 5 | status1 == 6 | s
> tatus1 == 7
 11.         drop if lfs1 == ""
 12. 
.         gen str2 lfs2 = lfs0 + lfs1
 13.         
.         sort lfs2
 14.         keep if lfs2 == "EE" & (samejob1 == 1 | samejob1 == 2)
 15.         
.         replace lfs2 = cond(samejob1 == 1,"JStay","J2J")
 16. 
.         replace fweight0 = 0 if fweight0 == .
 17.         replace fweight1 = 0 if fweight1 == .
 18.         gen weight = (fweight0 + fweight1) / 2
 19. 
.         egen double flows = sum(weight), by(lfs2)
 20.         replace flows = flows / 100000
 21. 
.         sort lfs2
 22.         quietly by lfs2:  gen duplic = cond(_N == 1,0,_n)
 23.         drop if duplic > 1
 24.         keep lfs2 flows
 25. 
.         gen date = `x'
 26.         reshape wide flows, i(date) j(lfs2) string
 27. 
.         gen flowJ2J = flowsJ2J /(flowsJStay + flowsJ2J)
 28.         drop flows*
 29.   }
 30. 
.   else {
 31.         clear
 32.         set obs 1
 33.         gen date = `x'
 34.         gen flowJ2J = .
 35.   }
 36. 
.   if `x' >= 199402 {
 37.     append using ../result/j2j.dta
 38.   }
 39.     
.   saveold ../result/j2j.dta, replace
 40.  }
 41.  
.  local x = `x' + 1
 42.  if (`x'-13)/100 == int((`x'-13)/100) {
 43.     local x = `x' + 88
 44.     noisily display (`x'-1)/100
 45.  }
 46. }
1995
1996
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
2007
2008
2009
2010
2011

. 
. rename flowJ2J flowsJ2J 

. 
. sort date

. gen t = tm(1994m1) + _n - 1

. format t %tm

. gen int year = int( date /100 )

. gen int month = int( (date - year*100) )

. gen qtr = int((month - 1) / 3) + 1

. tsset t
        time variable:  t, 1994m1 to 2011m8
                delta:  1 month

. 
. order year qtr month date t, first

. sort year qtr month date t

. saveold ../result/j2j, replace
file ../result/j2j.dta saved

. 
. 
. 
. *** Seasonally adjust the flows (ratio-to-MA method):
. qui foreach XY in J2J {

.  
. keep year qtr month date t SA_*

. sort year qtr month date t

. 
. save ../result/sa_j2j.dta, replace
file ../result/sa_j2j.dta saved

. 
. log close
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_flows_j2j.log
  log type:  text
 closed on:  22 May 2012, 22:59:58
------------------------------------------------------------------------------------------------
