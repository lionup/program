------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_edu_j2j.log
  log type:  text
 opened on:  22 May 2012, 23:07:44

. 
. local x = 199401

. while `x' <= 201108 {
  2.   quietly {
  3.     if `x' != 199401 & `x' != 199506 & `x' != 199507 & `x' != 199508 & `x' != 199509 {
  4.          
.           use ../basic_extract/merg`x', replace
  5.           
.           * keep only the records at least 16 years old and with no missing value on labor sta
> tus in both months and eduction on first month
.           keep if age >= 16
  6. 
.           gen str1 lfs0 = "E" if status0 == 1 | status0 == 2
  7.           replace lfs0 = "U" if status0 == 3 
  8.           replace lfs0 = "I" if status0 == 4 | status0 == 5 | status0 == 6 | status0 == 7
  9.           replace lfs0 = "U" if status0 == 4 & `x' > 198901
 10.           drop if lfs0 == ""
 11.           gen str1 lfs1 = "E" if status1 == 1 | status1 == 2
 12.           replace lfs1 = "U" if status1 == 3 
 13.           replace lfs1 = "I" if status1 == 4 | status1 == 5 | status1 == 6 | status1 == 7
 14.           replace lfs1 = "U" if status1 == 4 & `x' > 198900
 15.           drop if lfs1 == ""
 16. 
.           gen str2 lfs2 = lfs0 + lfs1
 17.       
.           sort lfs2
 18.           keep if lfs2 == "EE" & (samejob1 == 1 | samejob1 == 2)
 19.       replace lfs2 = cond(samejob1 == 1,"JStay","J2J")
 20. 
.           * flows conditional on the eduction category of last month
.           drop if educ6c0 == .  
 21.           tostring educ6c0, gen(educ2)
 22. 
.       gen lfsEduc = lfs2 + educ2
 23.           sort lfsEduc
 24. 
.           replace fweight0 = 0 if fweight0 == .
 25.           replace fweight1 = 0 if fweight1 == .
 26.           gen weight = (fweight0 + fweight1) / 2
 27.           egen double flows = sum(weight), by(lfsEduc)
 28.           replace flows = flows/1000
 29.           if `x' > 199400 { 
 30.             replace flows = flows / 100
 31.           }
 32. 
.           sort lfsEduc
 33.           quietly by lfsEduc:  gen duplic = cond(_N==1,0,_n)
 34.           drop if duplic > 1
 35.           keep lfsEduc flows
 36. 
.           gen date = `x'
 37.           reshape wide flows, i(date) j(lfsEduc) string
 38.       
.           forvalues i = 1/6 {
 39.             gen flowJ2J`i' = flowsJ2J`i' / (flowsJStay`i' + flowsJ2J`i')
 40.           }
 41.           drop flows*
 42.         }
 43. 
.         else {
 44.           clear
 45.           set obs 1
 46.           gen date = `x'
 47.           forvalues i = 1/6 {
 48.             gen flowJ2J`i' = .
 49.           }
 50.         }
 51. 
.         if `x' >= 199402 {
 52.       append using ../result/edu_j2j.dta
 53.     }
 54.     
.         saveold ../result/edu_j2j.dta, replace
 55.   }
 56.  
.   local x = `x' + 1
 57.   if (`x'-13)/100 == int((`x'-13)/100) {
 58.     local x = `x' + 88
 59.     noisily display (`x'-1)/100
 60.   }
 61. }
1995
1996
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
2007
2008
2009
2010
2011

. 
. forvalues i = 1/6 {
  2.   rename flowJ2J`i' flowsJ2J`i'
  3. }

. 
. order _all, alpha

. 
. sort date

. gen t = tm(1994m1) + _n - 1

. format t %tm

. tsset t
        time variable:  t, 1994m1 to 2011m8
                delta:  1 month

. gen int year = int( date /100 )

. gen int month = int( (date - year*100) )

. gen qtr = int((month - 1) / 3) + 1

. 
. order year qtr month date t, first

. sort year qtr month date t

. saveold ../result/edu_j2j.dta, replace
file ../result/edu_j2j.dta saved

. 
. 
. log close
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_edu_j2j.log
  log type:  text
 closed on:  22 May 2012, 23:09:08
------------------------------------------------------------------------------------------------
