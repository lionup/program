------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_edu_occ1.log
  log type:  text
 opened on:   9 Jun 2012, 17:40:55

. 
. local x = 197601

. while `x' <= 201108 {
  2. 
.   quietly {
  3.     if `x' != 197601 & `x' != 197801 & `x' != 198507 & `x' != 198510 & `x' != 199401 & `x' 
> != 199506 & `x' != 199507 & `x' != 199508 & `x' != 199509 {
  4. 
.           use ../basic_extract/merg`x', replace
  5.           
. * keep only the records at least 16 years old and with no missing value on employment status, 
> education, and occupation in both months
.           keep if age >= 16
  6.           
.           gen str1 lfs0 = "E" if status0 == 1 | status0 == 2
  7.           replace lfs0 = "U" if status0 == 3 
  8.           replace lfs0 = "I" if status0 == 4 | status0 == 5 | status0 == 6 | status0 == 7
  9.           replace lfs0 = "U" if status0 == 4 & `x' > 198901
 10.           keep if lfs0 == "E" | lfs0 == "U"
 11.           gen str1 lfs1 = "E" if status1 == 1 | status1 == 2
 12.           replace lfs1 = "U" if status1 == 3 
 13.           replace lfs1 = "I" if status1 == 4 | status1 == 5 | status1 == 6 | status1 == 7
 14.           replace lfs1 = "U" if status1 == 4 & `x' > 198900
 15.           keep if lfs1 == "E" | lfs0 == "U"
 16.           
.           * give value 99 to the occupation of unemployment
.           replace mocc1990_0 = 99 if lfs0 == "U"
 17.           replace mocc1990_1 = 99 if lfs1 == "U"
 18.           
.       drop if mocc1990_0 == . | mocc1990_0 ==14 | mocc1990_0 ==15 | mocc1990_1 == .| mocc1990_
> 1 ==14 | mocc1990_1 ==15 | educ6c0 == . 
 19.           tostring educ6c0, gen(educ2)   
 20.       tostring mocc1990_0, gen(occ0)
 21.       tostring mocc1990_1, gen(occ1)    
 22.       replace occ1 = "o" + occ1
 23.       replace educ2 = "e" + educ2
 24.       gen str9 occ0_occ1_e = occ0 + "_" + occ1 + "_" + educ2
 25.       sort occ0_occ1_e
 26.       
.       * sum weight for each category  
.           replace fweight0 = 0 if fweight0 == .
 27.           replace fweight1 = 0 if fweight1 == .
 28.           gen weight = (fweight0 + fweight1) / 2
 29.           egen double O = sum(weight), by(occ0_occ1_e)
 30. 
.           sort occ0_occ1_e
 31.           quietly by occ0_occ1_e:  gen duplic = cond(_N==1,0,_n)
 32.           drop if duplic > 1
 33.           keep occ0_occ1_e O
 34.           
.           gen date = `x'
 35.           reshape wide O, i(date) j(occ0_occ1_e) string
 36.           
.           * some transitions do not exist so just give them value 0
.       foreach m of numlist 1/13 99 {
 37.         foreach n of numlist 1/13 99 {
 38.           forvalues i = 1/6 {
 39.             capture confirm variable O`m'_o`n'_e`i', exact
 40.             if _rc {
 41.             gen O`m'_o`n'_e`i' = 0
 42.             }          
 43.           }
 44.         }
 45.       }
 46.       
.       * calculate the monthly sum by occupation last month
.       foreach m of numlist 1/13 99 {
 47.         forvalues i = 1/6 {
 48.           gen double monthsum`m'e`i' = 0 
 49.           foreach n of numlist 1/13 99 {
 50.             replace monthsum`m'e`i' = monthsum`m'e`i' + O`m'_o`n'_e`i'
 51.           }
 52.         }
 53.       }
 54.       
.       * calculate the rates from the levels
.       foreach m of numlist 1/13 99 {
 55.         foreach n of numlist 1/13 99 {
 56.           forvalues i = 1/6 {
 57.             gen o`m'_o`n'_e`i' = O`m'_o`n'_e`i' / monthsum`m'e`i'
 58.           }
 59.         }
 60.       }
 61. 
.       drop monthsum* O*
 62.     }
 63.     
.     else {
 64.           clear
 65.           set obs 1
 66.           gen date = `x'
 67.       foreach m of numlist 1/13 99 {
 68.         foreach n of numlist 1/13 99 {
 69.           forvalues i = 1/6 {
 70.             gen o`m'_o`n'_e`i' = 0
 71.           }
 72.         }
 73.       }
 74.     }
 75.   
.     if `x' >= 197602 {
 76.       append using ../result/edu_occ1.dta
 77.     }
 78.     
.         saveold ../result/edu_occ1.dta, replace
 79.   }
 80. 
.   local x = `x' + 1
 81.   if (`x'-13)/100 == int((`x'-13)/100) {
 82.     local x = `x' + 88
 83.     noisily display (`x'-1)/100
 84.   }
 85. }
1977
1978
1979
1980
1981
1982
1983
1984
1985
1986
1987
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
2007
2008
2009
2010
2011

. 
. 
. sort date 

. gen t = tm(1976m1) + _n - 1

. format t %tm

. tsset t
        time variable:  t, 1976m1 to 2011m8
                delta:  1 month

. gen int year = int( date /100 )

. gen int month = int( (date - year*100) )

. gen qtr = int((month - 1) / 3) + 1

. 
. order _all, seq

. order year qtr month date t, first

. sort year qtr month date t

. 
. saveold ../result/edu_occ1.dta, replace
file ../result/edu_occ1.dta saved

. 
. 
. log close
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_edu_occ1.log
  log type:  text
 closed on:   9 Jun 2012, 17:53:34
------------------------------------------------------------------------------------------------
