------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_flows_basic.log
  log type:  text
 opened on:  22 May 2012, 22:43:49

. 
. local x = 197601

. while `x' <= 201108 {
  2. 
.   quietly {
  3.     if `x' != 197601 & `x' != 197801 & `x' != 198507 & `x' != 198510 & `x' != 199401 & `x' 
> != 199506 & `x' != 199507 & `x' != 199508 & `x' != 199509 {
  4. 
.           use ../basic_extract/merg`x', replace
  5.           
.           * keep only the records at least 16 years old and with no missing value on labor sta
> tus in both months
.           keep if age >= 16
  6. 
.           gen str1 lfs0 = "E" if status0 == 1 | status0 == 2
  7.           replace lfs0 = "U" if status0 == 3 
  8.           replace lfs0 = "I" if status0 == 4 | status0 == 5 | status0 == 6 | status0 == 7
  9.           replace lfs0 = "U" if status0 == 4 & `x' > 198901
 10.           drop if lfs0 == ""
 11.           gen str1 lfs1 = "E" if status1 == 1 | status1 == 2
 12.           replace lfs1 = "U" if status1 == 3 
 13.           replace lfs1 = "I" if status1 == 4 | status1 == 5 | status1 == 6 | status1 == 7
 14.           replace lfs1 = "U" if status1 == 4 & `x' > 198900
 15.           drop if lfs1 == ""
 16. 
. 
.           gen str2 lfs2 = lfs0 + lfs1
 17. 
.           sort lfs2
 18.           replace fweight0 = 0 if fweight0 == .
 19.           replace fweight1 = 0 if fweight1 == .
 20.           gen weight = (fweight0 + fweight1) / 2
 21.           egen double flows = sum(weight), by(lfs2)
 22.           replace flows = flows/1000
 23.           if `x' > 199400 { 
 24.             replace flows = flows / 100
 25.           }
 26. 
.           sort lfs2
 27.           quietly by lfs2:  gen duplic = cond(_N==1,0,_n)
 28.           drop if duplic > 1
 29.           keep lfs2 flows
 30. 
.           gen date = `x'
 31.           reshape wide flows, i(date) j(lfs2) string
 32. 
.           gen flowEU = flowsEU / (flowsEE + flowsEU + flowsEI)
 33.           gen flowUE = flowsUE / (flowsUE + flowsUU + flowsUI)
 34.           drop flows*
 35.         }
 36. 
.         else {
 37.           clear
 38.           set obs 1
 39.           gen date = `x'
 40.           gen flowEU = .
 41.           gen flowUE = .
 42.         }
 43. 
.         if `x' >= 197602 {
 44.       append using ../result/basic.dta
 45.     }
 46.     
.         saveold ../result/basic.dta, replace
 47.   }
 48.  
.   local x = `x' + 1
 49.   if (`x'-13)/100 == int((`x'-13)/100) {
 50.     local x = `x' + 88
 51.     noisily display (`x'-1)/100
 52.   }
 53. }
1977
1978
1979
1980
1981
1982
1983
1984
1985
1986
1987
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
2007
2008
2009
2010
2011

. 
. sort date

. saveold ../result/basic.dta, replace
file ../result/basic.dta saved

. 
. 
. *** Take the Bleakley/Ritter data
. clear 

. use flows_67

. keep if date <= 197601
(311 observations deleted)

. keep date flowsEU flowsUE

. order _all, alpha

. save temp1, replace
(note: file temp1.dta not found)
file temp1.dta saved

. 
. clear

. use ../result/basic

. rename flowEU flowsEU 

. rename flowUE flowsUE 

. drop if date == 197601
(1 observation deleted)

. order _all, alpha

. 
. 
. *** Merge it with older data
. append using temp1
date was float now double

. erase temp1.dta

. 
. sort date

. gen t = tm(1967m6) + _n - 1

. format t %tm

. tsset t
        time variable:  t, 1967m6 to 2011m8
                delta:  1 month

. gen int year = int( date /100 )

. gen int month = int( (date - year*100) )

. gen qtr = int((month - 1) / 3) + 1

. 
. order year qtr month date t, first

. sort year qtr month date t

. saveold ../result/basic.dta, replace
file ../result/basic.dta saved

. 
. 
. *** Seasonally adjust the flows (ratio-to-MA method):
. qui foreach XY in EU UE {

.  
. keep year qtr month date t SA_*

. sort year qtr month date t

. 
. save ../result/sa_basic.dta, replace
file ../result/sa_basic.dta saved

. 
. log close
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_flows_basic.log
  log type:  text
 closed on:  22 May 2012, 22:58:43
------------------------------------------------------------------------------------------------
