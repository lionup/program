------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_ind1_occ1_flows_edu.log
  log type:  text
 opened on:  30 May 2012, 15:36:55

. 
. local x = 197602

. while `x' <= 201108 {
  2. 
.   quietly {
  3.     if `x' != 197801 & `x' != 198507 & `x' != 198510 & `x' != 199401 & `x' != 199506 & `x' 
> != 199507 & `x' != 199508 & `x' != 199509 {
  4. 
.           use ../basic_extract/merg`x', replace
  5.           
. * keep only the records at least 16 years old and with no missing value on industry and occupa
> tion in both months
.           keep if age >= 16
  6.           keep if (status0 == 1 | status0 == 2) & (status1 == 1 | status1 == 2)
  7.       drop if mocc1990_0 == . | mind7090_0 == . | mocc1990_1 == . | mind7090_1 == .
  8. 
. * create sorting variable "indOcc2" categoried by industry and occupation
.       tostring mocc1990_0, gen(occ2_0)
  9.       tostring mind7090_0, gen(ind2_0)
 10.       tostring mocc1990_1, gen(occ2_1)
 11.       tostring mind7090_1, gen(ind2_1)
 12.       
.       replace occ2_0 = "o" + occ2_0
 13.       replace ind2_0 = "i" + ind2_0
 14.       gen str6 indOcc0 = ind2_0 + occ2_0
 15.       
.       replace occ2_1 = "o" + occ2_1
 16.       replace ind2_1 = "i" + ind2_1
 17.       gen str6 indOcc1 = ind2_1 + occ2_1
 18.       
.       gen str13 indOcc2 = indOcc0 + "_" + indOcc1
 19.       
. * flows conditional on the eduction category of last month
.           drop if educ6c0 == .  
 20.           tostring educ6c0, gen(educ2)
 21. 
.       sort indOcc2 educ2
 22. 
.           replace fweight0 = 0 if fweight0 == .
 23.           replace fweight1 = 0 if fweight1 == .
 24.           gen weight = (fweight0 + fweight1) / 2
 25.           egen double E = sum(weight), by(indOcc2 educ2)
 26. 
.           sort indOcc2 educ2
 27.           quietly by indOcc2 educ2:  gen duplic = cond(_N==1,0,_n)
 28.           drop if duplic > 1
 29.           keep indOcc2 educ2 E
 30.           
.           reshape wide E, i(indOcc2) j(educ2) string
 31. 
.           gen date = `x'
 32.           
.           * calculate the rates from the levels
.       gen double rowsum = 0
 33.       forvalues n = 1/6 {
 34.         replace E`n' = 0 if E`n'== .
 35.         replace rowsum = rowsum + E`n'
 36.       }
 37.       
.       forvalues n = 1/6 {
 38.         replace E`n' = E`n'/rowsum
 39.       } 
 40.       drop rowsum
 41.       
.       if `x' >= 197603 {
 42.         append using ../result/ind1_occ1_flows_edu.dta
 43.       }
 44.       saveold ../result/ind1_occ1_flows_edu.dta, replace
 45.         }       
 46.   }
 47.  
.   local x = `x' + 1
 48.   if (`x'-13)/100 == int((`x'-13)/100) {
 49.     local x = `x' + 88
 50.     noisily display (`x'-1)/100
 51.   }
 52. }
1977
1978
1979
1980
1981
1982
1983
1984
1985
1986
1987
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
2007
2008
2009
2010
2011

. 
. 
. sort date indOcc2

. gen int year = int( date /100 )

. gen int month = int( (date - year*100) )

. gen qtr = int((month - 1) / 3) + 1

. 
. order year qtr month date indOcc2, first

. sort year qtr month date indOcc2

. saveold ../result/ind1_occ1_flows_edu.dta, replace
file ../result/ind1_occ1_flows_edu.dta saved

. 
. 
. log close
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_ind1_occ1_flows_edu.log
  log type:  text
 closed on:  30 May 2012, 16:09:01
------------------------------------------------------------------------------------------------
