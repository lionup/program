------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_ind3_occ3.log
  log type:  text
 opened on:   1 Jun 2012, 17:48:19

. 
. local x = 197601

. while `x' <= 201108 {
  2.   use ../basic_extract/cps`x'.dta, clear
  3.   * keep only the records at least 16 years old, employed, and with no missing value on edu
> cation, ind7090, occ1990
.   keep if age >= 16
  4.   keep if status == 1 | status == 2
  5.   drop if educ6c == . | ind7090 == . | occ1990 == .
  6. 
.   sort ind7090 occ1990 educ6c
  7. 
.   * sum weight for each category  
.   replace fweight = 0 if fweight == .
  8.   egen double em_share = total(fweight), by (ind7090 occ1990 educ6c)
  9.   replace em_share = em_share / 1000
 10.   if `x' > 199400 { 
 11.         replace em_share = em_share / 100
 12.   }
 13.   
.   sort ind7090 occ1990 educ6c
 14.   quietly by ind7090 occ1990 educ6c:  gen duplic = cond(_N==1,0,_n)
 15.   drop if duplic > 1
 16.   keep ind7090 occ1990 educ6c em_share
 17.   gen date = `x'
 18.   egen monthsum = total(em_share)
 19.   replace em_share = em_share/monthsum
 20.   drop monthsum
 21.   
. * some industry, occupation, and education category do not exist so just give them value 0
.   local ind_num "11 20 21 30 31 40 41 42 50 60 100 101 102 110 111 112 120 121 122 130 132 140
>  141 142 150 151 152 160 161 162 171 172 180 181 182 190 191 192 200 201 211 212 220 221 222 2
> 30 231 241 242 250 251 252 261 262 270 271 272 280 281 282 290 291 300 301 310 311 312 320 321
>  322 331 332 340 341 342 350 351 360 361 362 370 371 372 380 381 391 392 400 401 402 410 411 4
> 12 420 421 422 432 441 442 460 461 462 470 471 472 500 502 511 512 521 531 540 541 542 550 551
>  552 560 561 562 571 580 581 591 592 600 601 602 610 611 612 620 621 622 630 631 632 640 641 6
> 42 650 660 670 671 672 681 682 691 700 702 710 711 712 721 722 731 732 740 741 742 750 752 760
>  761 762 770 771 772 780 782 790 800 801 802 812 820 821 822 831 832 840 841 842 850 852 860 8
> 70 871 872 880 881 882 890 901"
 22.   
.   local occ_num "3 4 7 8 13 14 15 16 17 18 19 21 22 23 24 25 26 27 28 29 33 34 35 36 37 43 44 
> 45 47 48 53 55 56 57 59 64 65 66 67 68 69 73 74 75 76 77 78 79 83 84 85 86 87 88 89 95 96 97 9
> 8 99 103 104 105 106 113 114 115 116 118 119 123 125 127 128 139 145 147 149 150 154 155 156 1
> 57 158 159 163 164 165 166 167 168 169 173 174 175 176 178 179 183 184 185 186 187 188 189 193
>  194 195 198 199 200 203 204 205 206 207 208 213 214 215 217 218 223 224 225 226 227 228 229 2
> 33 234 235 243 253 254 255 256 258 274 275 276 277 283 290 303 308 313 314 315 316 317 318 319
>  323 326 328 329 335 336 337 338 343 344 345 346 347 348 349 354 355 356 357 359 361 364 365 3
> 66 368 373 375 376 377 378 379 383 384 385 386 387 389 390 391 405 407 408 415 417 418 423 425
>  426 427 434 435 436 438 439 443 444 445 446 447 448 453 454 455 456 457 458 459 461 462 463 4
> 64 465 468 469 473 474 475 476 479 480 483 484 485 486 487 488 489 496 498 503 505 507 508 509
>  514 516 518 519 523 525 526 527 533 534 535 536 538 539 543 544 549 558 563 567 573 575 577 5
> 79 583 584 585 588 589 593 594 595 596 597 598 599 614 615 616 617 628 634 637 643 644 645 646
>  649 653 657 658 659 666 667 668 669 674 675 677 678 679 684 686 687 688 693 694 695 696 699 7
> 03 706 707 708 709 713 717 719 723 724 726 727 728 729 733 734 735 736 738 739 743 744 745 747
>  748 749 753 754 755 756 757 759 763 764 765 766 768 769 773 774 779 783 784 785 789 796 799 8
> 03 804 808 809 813 815 823 824 825 829 834 844 848 853 859 865 866 869 874 875 876 877 878 883
>  885 887 888 889 890" 
 23.   
.   qui foreach i of local ind_num {      
 24.         foreach j of local occ_num { 
 25.           forvalues m = 1/6 {
 26.             count if ind7090 == `i' & occ1990 == `j' & educ6c == `m'
 27.             if r(N) == 0 {
 28.                 set obs `=_N + 1'
 29.                 replace date = `x'
 30.                             replace ind7090 = `i' in L
 31.                             replace occ1990 = `j' in L
 32.                             replace educ6c = `m' in L
 33.                 replace em_share = 0 in L
 34.             }
 35.           }
 36.         }
 37.       }
 38.   sort ind7090 occ1990 educ6c
 39.   
. 
.    * generate sorting variables
.   gen year = int( date /100 )
 40.   gen month = int( (date - year*100) )
 41.   gen qtr = int((month - 1) / 3) + 1
 42.   order year qtr month date ind7090 occ1990 educ6c em_share, first
 43. 
.   if `x' != 197601{
 44.         append using ../result/ind3_occ3.dta
 45.   }
 46.   sort year qtr month date ind7090 occ1990 educ6c
 47.   saveold ../result/ind3_occ3.dta, replace
 48. 
.   local x = `x' + 1
 49.   if (`x'-13)/100 == int((`x'-13)/100) {
 50.     local x = `x' + 88
 51.     noisily display (`x'-1)/100
 52.   }
 53. }
(5291 observations deleted)
(41721 observations deleted)
(0 observations deleted)
(0 real changes made)
(51264 real changes made)
(38300 observations deleted)
(12964 real changes made)
file ../result/ind3_occ3.dta saved
(5272 observations deleted)
(41509 observations deleted)
(2 observations deleted)
(0 real changes made)
(51135 real changes made)
(38144 observations deleted)
(12991 real changes made)
(label ind7090 already defined)
(label educ6c already defined)
(label occ1990 already defined)
file ../result/ind3_occ3.dta saved
(5242 observations deleted)
(40919 observations deleted)
(2 observations deleted)
(0 real changes made)
(51396 real changes made)
(38416 observations deleted)
(12980 real changes made)
(label ind7090 already defined)
(label educ6c already defined)
(label occ1990 already defined)
file ../result/ind3_occ3.dta saved
(5342 observations deleted)
(40835 observations deleted)
(0 observations deleted)
(0 real changes made)
(52593 real changes made)
(39473 observations deleted)
(13120 real changes made)
(label ind7090 already defined)
(label educ6c already defined)
(label occ1990 already defined)
file ../result/ind3_occ3.dta saved
(5418 observations deleted)
(40552 observations deleted)
(1 observation deleted)
(0 real changes made)
(52950 real changes made)
(39669 observations deleted)
(13281 real changes made)
(label ind7090 already defined)
(label educ6c already defined)
(label occ1990 already defined)
file ../result/ind3_occ3.dta saved
(5379 observations deleted)
(39945 observations deleted)
(2 observations deleted)
(0 real changes made)
(53914 real changes made)
(40444 observations deleted)
(13470 real changes made)
(label ind7090 already defined)
(label educ6c already defined)
(label occ1990 already defined)
file ../result/ind3_occ3.dta saved
(5308 observations deleted)
(39090 observations deleted)
(1 observation deleted)
(0 real changes made)
(54200 real changes made)
(40534 observations deleted)
(13666 real changes made)
(label ind7090 already defined)
(label educ6c already defined)
(label occ1990 already defined)
file ../result/ind3_occ3.dta saved
(5376 observations deleted)
(39484 observations deleted)
(4 observations deleted)
(0 real changes made)
(53833 real changes made)
(40377 observations deleted)
(13456 real changes made)
(label ind7090 already defined)
(label educ6c already defined)
(label occ1990 already defined)
file ../result/ind3_occ3.dta saved
(5341 observations deleted)
(40580 observations deleted)
(3 observations deleted)
(0 real changes made)
(53145 real changes made)
(39926 observations deleted)
(13219 real changes made)
(label ind7090 already defined)
(label educ6c already defined)
(label occ1990 already defined)
file ../result/ind3_occ3.dta saved
(5400 observations deleted)
(40377 observations deleted)
(0 observations deleted)
(0 real changes made)
(53943 real changes made)
(40644 observations deleted)
(13299 real changes made)
(label ind7090 already defined)
(label educ6c already defined)
(label occ1990 already defined)
file ../result/ind3_occ3.dta saved
(5471 observations deleted)
(40515 observations deleted)
(0 observations deleted)
(0 real changes made)
(53886 real changes made)
(40435 observations deleted)
(13451 real changes made)
(label ind7090 already defined)
(label educ6c already defined)
(label occ1990 already defined)
file ../result/ind3_occ3.dta saved
(5431 observations deleted)
(40725 observations deleted)
(3 observations deleted)
(0 real changes made)
(53915 real changes made)
(40496 observations deleted)
