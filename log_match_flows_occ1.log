------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_flows_occ1.log
  log type:  text
 opened on:   9 Jun 2012, 17:30:26

. 
. local x = 197601

. while `x' <= 201108 {
  2. 
.   quietly {
  3.     if `x' != 197601 & `x' != 197801 & `x' != 198507 & `x' != 198510 & `x' != 199401 & `x' 
> != 199506 & `x' != 199507 & `x' != 199508 & `x' != 199509 {
  4. 
.           use ../basic_extract/merg`x', replace
  5.           
. * keep only the records at least 16 years old and with no missing value on employment status a
> nd industry in both months
.           keep if age >= 16
  6.           
.           gen str1 lfs0 = "E" if status0 == 1 | status0 == 2
  7.           replace lfs0 = "U" if status0 == 3 
  8.           replace lfs0 = "I" if status0 == 4 | status0 == 5 | status0 == 6 | status0 == 7
  9.           replace lfs0 = "U" if status0 == 4 & `x' > 198901
 10.           keep if lfs0 == "E" | lfs0 == "U"
 11.           gen str1 lfs1 = "E" if status1 == 1 | status1 == 2
 12.           replace lfs1 = "U" if status1 == 3 
 13.           replace lfs1 = "I" if status1 == 4 | status1 == 5 | status1 == 6 | status1 == 7
 14.           replace lfs1 = "U" if status1 == 4 & `x' > 198900
 15.           keep if lfs1 == "E" | lfs0 == "U"
 16.           
.           * give value 99 to the industry of unemployment
.           replace mocc1990_0 = 99 if lfs0 == "U"
 17.           replace mocc1990_1 = 99 if lfs1 == "U"
 18.           
.       drop if mocc1990_0 == . | mocc1990_0 ==14 | mocc1990_0 ==15 | mocc1990_1 == .| mocc1990_
> 1 ==14 | mocc1990_1 ==15
 19.       
.       tostring mocc1990_0, gen(occ0)
 20.       tostring mocc1990_1, gen(occ1)    
 21.       replace occ1 = "o" + occ1
 22.       gen str6 occ0_occ1 = occ0 + "_" + occ1
 23.       sort occ0_occ1
 24.       
.       * sum weight for each category  
.           replace fweight0 = 0 if fweight0 == .
 25.           replace fweight1 = 0 if fweight1 == .
 26.           gen weight = (fweight0 + fweight1) / 2
 27.           egen double O = sum(weight), by(occ0_occ1)
 28. 
.           sort occ0_occ1
 29.           quietly by occ0_occ1:  gen duplic = cond(_N==1,0,_n)
 30.           drop if duplic > 1
 31.           keep occ0_occ1 O
 32.           
.           gen date = `x'
 33.           reshape wide O, i(date) j(occ0_occ1) string
 34.           
.           * some transitions do not exist so just give them value 0
.       foreach m of numlist 1/13 99 {
 35.         foreach n of numlist 1/13 99 {
 36.           capture confirm variable O`m'_o`n', exact
 37.           if _rc {
 38.             gen O`m'_o`n' = 0
 39.           }
 40.         }
 41.       }
 42.       
.       * calculate the monthly sum by industry last month
.       foreach m of numlist 1/13 99 {
 43.         gen double monthsum`m' = 0 
 44.         foreach n of numlist 1/13 99 {
 45.           replace monthsum`m' = monthsum`m' + O`m'_o`n'
 46.         }
 47.       }
 48.       
.       * calculate the rates from the levels
.       foreach m of numlist 1/13 99 {
 49.         foreach n of numlist 1/13 99 {
 50.           gen o`m'_o`n' = O`m'_o`n' / monthsum`m'
 51.         }
 52.       }
 53. 
.       drop monthsum* O*
 54.     }
 55.     
.     else {
 56.           clear
 57.           set obs 1
 58.           gen date = `x'
 59.       foreach m of numlist 1/13 99 {
 60.         foreach n of numlist 1/13 99 {
 61.           gen o`m'_o`n' = 0
 62.         }
 63.       }
 64.     }
 65.   
.     if `x' >= 197602 {
 66.       append using ../result/flows_occ1.dta
 67.     }
 68.     
.         saveold ../result/flows_occ1.dta, replace
 69.   }
 70. 
.   local x = `x' + 1
 71.   if (`x'-13)/100 == int((`x'-13)/100) {
 72.     local x = `x' + 88
 73.     noisily display (`x'-1)/100
 74.   }
 75. }
1977
1978
1979
1980
1981
1982
1983
1984
1985
1986
1987
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
2007
2008
2009
2010
2011

. 
. 
. sort date 

. gen t = tm(1976m1) + _n - 1

. format t %tm

. tsset t
        time variable:  t, 1976m1 to 2011m8
                delta:  1 month

. gen int year = int( date /100 )

. gen int month = int( (date - year*100) )

. gen qtr = int((month - 1) / 3) + 1

. 
. order _all, seq

. order year qtr month date t, first

. sort year qtr month date t

. 
. saveold ../result/flows_occ1.dta, replace
file ../result/flows_occ1.dta saved

. 
. 
. log close
      name:  <unnamed>
       log:  /data/uctprgu/cps/program/log_match_flows_occ1.log
  log type:  text
 closed on:   9 Jun 2012, 17:35:15
------------------------------------------------------------------------------------------------
